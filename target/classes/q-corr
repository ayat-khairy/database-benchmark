match (z:zone)<-[:LOCATED_IN]-(p:parkingplaces)<-[:LOCATED_IN]-(c:carparking)  where  z.zone_name='huntingdon_road'  with c.hour as hour  ,avg (c.spaces_occupied)as avgCarP match (r:aq_reading)-[:MADE_BY]->(s:station)-[:LOCATED_IN]->(z:zone)  where  z.zone_name='huntingdon_road' AND r.sensortype='CO' AND r.hour = hour  return hour , avg(r.reading) , avgCarP order by hour
match (r:aq_reading)-[:MADE_BY]->(s:station)-[:LOCATED_IN]->(z:zone)using index r:aq_reading(sensortype) where r.sensortype='CO'  with  avg(r.reading) as u1_mean match (z:zone )<-[:LOCATED_IN]-(p:parkingplaces)<-[:LOCATED_IN]-(c:carparking) with avg(c.spaces_occupied) as u2_mean,  u1_mean match (r:aq_reading)-[:MADE_BY]->(s:station)-[:LOCATED_IN]->(z:zone)<-[:LOCATED_IN]-(p:parkingplaces)<-[:LOCATED_IN]-(c:carparking) using index r:aq_reading(sensortype) using index z:zone(zone_name)   where r.sensortype='CO' AND  z.zone_name='huntingdon_road'   with  sum((r.reading - u1_mean) *(c.spaces_occupied-u2_mean)) as num, sqrt(sum((r.reading-u1_mean)^2) * sum((c.spaces_occupied-u2_mean)^2)) as denom   return (num/denom) as corr_coef
