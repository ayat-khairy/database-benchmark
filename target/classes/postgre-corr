with record AS (Select carparking.hour as hour,avg (carparking.spaces_occupied) as carAvg  from carparking, parkingplaces, zone where  carparking.parking_id= parkingplaces.parking_id AND parkingplaces.zoneid=zone.id  AND  zone.zone_name='huntingdon_road' Group by  carparking.hour)  select record.hour, avg (reading) , record.carAvg from aq_reading , zone, station, record  where sensortype= 'CO' AND aq_reading.stationid = station.stationid AND station.zoneid = zone.id AND zone.zone_name='huntingdon_road' AND aq_reading.hour = record.hour  GROUP BY record.hour , record.carAvg ;
Select  corr  (reading, spaces_occupied) from carparking, aq_reading, station, parkingplaces, zone where  station.stationid =aq_reading.stationid AND station.zoneid= zone.id AND  carparking.parking_id= parkingplaces.parking_id AND parkingplaces.zoneid=zone.id  AND  zone.zone_name='huntingdon_road' AND carparking.day = aq_reading.day;
Select r1.hour, corr( r1.reading , r2.reading) from  aq_reading r1 , aq_reading r2 where r1.stationid in (Select  station.stationid from station, zone where station.zoneid=zone.id AND zone.zone_name='huntingdon_road')  AND  r2.stationid in (Select  station.stationid from station, zone where station.zoneid=zone.id AND zone.zone_name='huntingdon_road') AND r1.sensortype = 'CO' AND r2.sensortype = 'CO' AND r1.hour = r2.hour AND r1.day=1 AND r2.day=1 AND r1.stationid <> r2.stationid group by r1.hour ;
